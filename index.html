<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>To-Do List</title>
</head>

<body>
    <div class="todo-frame">
        <h2 class="title">To-Do List</h2>
        <ul id="taskList">

        </ul>
        <div class="task">
            <input type="text" id="newTaskInput" placeholder="Enter a new task...">
        </div>
        <button class="show-more-button">Show hidden tasks</button>
    </div>

    <script>
        var draggedItem = null;


    function dragStart(event) {
        draggedItem = event.target;
        event.dataTransfer.effectAllowed = 'move';
        event.dataTransfer.setData('text/html', draggedItem.innerHTML);
    }

    function allowDrop(event) {
        event.preventDefault();
        var draggedOverItem = event.target;
        draggedOverItem.classList.add('dragging');
    }

    function drop(event) {
        event.preventDefault();
        var droppedOnItem = event.target;
        draggedItem.innerHTML = droppedOnItem.innerHTML;
        droppedOnItem.innerHTML = event.dataTransfer.getData('text/html');
        draggedItem.classList.remove('dragging');
    }

    function toggleExpandedBox(infoIcon, expandedBoxId) {
        const task = infoIcon.closest('.task');
        const expandedBox = task.querySelector(`#${expandedBoxId}`);
        expandedBox.style.display = expandedBox.style.display === 'block' ? 'none' : 'block';
    }

    function addCollapsibleEventListener(collapsible) {
        var content = collapsible.querySelector('.content');
        var span = collapsible.querySelector('.info-icon');

        span.addEventListener('click', function () {
            console.log('clicked');
            if (content.style.display === 'block') {
                content.style.display = 'none';
            } else {
                content.style.display = 'block';
            }
        });
    }

    var collapsibles = document.querySelectorAll('.collapsible');

    collapsibles.forEach(function (collapsible) {
        // Add event listener for existing collapsible items
        addCollapsibleEventListener(collapsible);
    });

    function addTask(event) {
        if (event.key === 'Enter') {
            const newTaskInput = document.getElementById('newTaskInput');
            const taskList = document.getElementById('taskList');

            const newTask = document.createElement('li');
            newTask.draggable = true;
            newTask.ondragstart = function (event) {
                dragStart(event);
            };
            newTask.ondragover = function (event) {
                allowDrop(event);
            };
            newTask.ondrop = function (event) {
                drop(event);
            };
            newTask.innerHTML = `
        <div class="task">
            <input type="checkbox" class="checkbox" onchange="handleCheckboxChange(this)">
            <input type="text" class="task-input" value="${newTaskInput.value}">
            <input type="date" class="task-date">
            <span class="info-icon">&#9432;</span>
        </div>
        <div class="content">
            <input type="text" placeholder="Notes">
        </div>`;
            newTask.classList.add('collapsible');

            // Insert the new task at the button of the task list
            taskList.appendChild(newTask);

            addCollapsibleEventListener(newTask);

            // Clear the input field
            newTaskInput.value = '';
        }
    }
    function handleCheckboxChange(checkbox) {
        const task = checkbox.closest('li');
        
        if (checkbox.checked) {
            // Set a timeout to hide the task after 2 seconds
            const timeoutId = setTimeout(function () {
                task.classList.add('hidden-task');
                task.style.display = 'none'; // Hide the task
            }, 2000);
    
            // Add a data attribute to store the timeout ID on the task element
            task.dataset.timeoutId = timeoutId;
        } else {
            // If the checkbox is unchecked, cancel the timeout
            const timeoutId = task.dataset.timeoutId;
            if (timeoutId) {
                clearTimeout(timeoutId);
                delete task.dataset.timeoutId;
            }
        }
    }
    
    function showHiddenTasks() {
        const hiddenTasks = document.querySelectorAll('.hidden-task');
    
        hiddenTasks.forEach(task => {
            if (task.style.display === 'none' || window.getComputedStyle(task).display === 'none') {
                task.style.display = 'block';
            } else {
                task.style.display = 'none';
            }
        });
    
        // Update button text based on the visibility of hidden tasks
        const showMoreButton = document.querySelector('.show-more-button');
        showMoreButton.textContent = showMoreButton.textContent === 'Show hidden tasks' ? 'Hide hidden tasks' : 'Show hidden tasks';
    }
    
    document.querySelector('.show-more-button').addEventListener('click', showHiddenTasks);
    
    document.getElementById('newTaskInput').addEventListener('keydown', addTask);
    </script>
</body>

</html>
