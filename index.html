<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>To-Do List</title>
</head>

<body>
    <div class="todo-frame">
        <h2 class="title">To-Do List</h2>
        <ul id="taskList">

            <li class="collapsible">
                <div class="task">
                    <input type="checkbox" class="checkbox" onchange="handleCheckboxChange(this)">
                    <input type="text" class="task-input" value="${newTaskInput.value}">
                    <input type="date" class="task-date">
                    <span class="info-icon">&#9432;</span>
                </div>
                <div class="content">
                    Additional information for Item 1.
                </div>
            </li>
        </ul>
        <div class="task">
            <input type="text" id="newTaskInput" placeholder="Enter a new task..." onkeydown="addTask(event)">
        </div>
        <button class="show-more-button" onclick="showHiddenTasks()">Show hidden tasks</button>
    </div>

    <script>

        var draggedItem = null;

        function dragStart(event) {
            draggedItem = event.target;
            event.dataTransfer.effectAllowed = 'move';
            event.dataTransfer.setData('text/html', draggedItem.innerHTML);
        }

        function allowDrop(event) {
            event.preventDefault();
            var draggedOverItem = event.target;
            draggedOverItem.classList.add('dragging');
        }

        function drop(event) {
            event.preventDefault();
            var droppedOnItem = event.target;
            draggedItem.innerHTML = droppedOnItem.innerHTML;
            droppedOnItem.innerHTML = event.dataTransfer.getData('text/html');
            draggedItem.classList.remove('dragging');
        }

        function toggleExpandedBox(infoIcon, expandedBoxId) {
            const task = infoIcon.closest('.task');
            const expandedBox = task.querySelector(`#${expandedBoxId}`);
            expandedBox.style.display = expandedBox.style.display === 'block' ? 'none' : 'block';
        }

        function addCollapsibleEventListener(collapsible) {
            var content = collapsible.querySelector('.content');
            var span = collapsible.querySelector('.info-icon');
        
            span.addEventListener('click', function () {
                console.log('clicked');
                if (content.style.display === 'block') {
                    content.style.display = 'none';
                } else {
                    content.style.display = 'block';
                }
            });
        }
        
        var collapsibles = document.querySelectorAll('.collapsible');
        
        collapsibles.forEach(function (collapsible) {
            // Add event listener for existing collapsible items
            addCollapsibleEventListener(collapsible);
        });

        function addTask(event) {
            if (event.key === 'Enter') {
                const newTaskInput = document.getElementById('newTaskInput');
                const taskList = document.getElementById('taskList');

                const newTask = document.createElement('li');
                newTask.draggable = true;
                newTask.ondragstart = function (event) {
                    dragStart(event);
                };
                newTask.ondragover = function (event) {
                    allowDrop(event);
                };
                newTask.ondrop = function (event) {
                    drop(event);
                };
                newTask.innerHTML = `
                <div class="task">
                    <input type="checkbox" class="checkbox" onchange="handleCheckboxChange(this)">
                    <input type="text" class="task-input" value="${newTaskInput.value}">
                    <input type="date" class="task-date">
                    <span class="info-icon">&#9432;</span>
                </div>
                <div class="content">
                    Additional information for Item 1.
                </div>`;
                newTask.classList.add('collapsible');

                // Insert the new task at the button of the task list
                taskList.appendChild(newTask);

                addCollapsibleEventListener(newTask);

                // Clear the input field
                newTaskInput.value = '';
            }
        }
        function handleCheckboxChange(checkbox) {
            const task = checkbox.closest('li');
            if (checkbox.checked) {
                setTimeout(function () {
                    task.classList.add('hidden-task');
                    task.style.display = 'none'; // Hide the task
                }, 2000);
            }
        }

        function showHiddenTasks() {
            const hiddenTasks = document.querySelectorAll('.hidden-task');
            hiddenTasks.forEach(task => {
                task.classList.remove('hidden-task');
                task.style.display = 'block'; // Show the task
                taskList.appendChild(task);
            });
        }
    </script>
</body>

</html>